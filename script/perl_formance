#! /usr/bin/env perl

use Getopt::Long;

sub usage {
        print "Perl::Formance - Perl Benchmark Suite\n\n";
        print "Usage:\n";
        print "$0 [ --sections=SA,Fib,Rx ]\n\n";
        print " 'sections' is list of comma separated values of\n";
        print "   SA ... SpamAssassin\n";
        print "   Fib ... Fibonnacci numbers\n";
        print "   Rx ... Regex and String stuff\n";
        print "   default is a list of all available sections\n";
}

my $help     = 0;
my $sections = 'Rx,RC,SA,Fib';
my $ok       = GetOptions ("help|h"     => \$help,
                           "sections=s" => \$sections);

do { usage; exit  0 } if $help;
do { usage; exit -1 } if not $ok;

my @sections = split ',', $sections;

my @run_sections = grep {
        eval "use Perl::Formance::Section::$_";
        print "Skip section $_:\n$@" if $@;
        not $@;
} @sections;

foreach (@run_sections) {
        #print STDERR "Do Perl::Formance::Section::$_ ...\n";
        "Perl::Formance::Section::$_"->main();
}

